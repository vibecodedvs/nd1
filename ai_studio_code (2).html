<!-- COPY AND PASTE THIS OVER THE PREVIOUS <SCRIPT> TAG -->
<script>
    // --- 1. SCROLL REVEAL ANIMATION ---
    document.addEventListener('DOMContentLoaded', () => {
        const reveals = document.querySelectorAll('.reveal');
        loadData(); // Load saved data on startup

        const revealOnScroll = () => {
            const windowHeight = window.innerHeight;
            const elementVisible = 100;
            reveals.forEach((reveal) => {
                const elementTop = reveal.getBoundingClientRect().top;
                if (elementTop < windowHeight - elementVisible) {
                    reveal.classList.add('active');
                }
            });
        };
        window.addEventListener('scroll', revealOnScroll);
        revealOnScroll();
    });

    // --- 2. CHECKBOX LOGIC + AUTO-SAVE ---
    function toggleCheck(el) {
        const parent = el.parentElement;
        if(el.checked) {
            parent.classList.add('checked');
        } else {
            parent.classList.remove('checked');
        }
        saveData(); // Save on click
    }

    // --- 3. AUTO-SAVE FUNCTIONALITY (Local Storage) ---
    // Listens for any keystroke in any text field to save data
    document.addEventListener('keyup', (e) => {
        if (e.target.matches('input, textarea')) {
            saveData();
        }
    });

    function saveData() {
        // Save all Inputs
        const inputs = document.querySelectorAll("input[type='text'], textarea");
        const inputData = {};
        inputs.forEach((input, index) => {
            inputData['input_' + index] = input.value;
        });

        // Save all Checkboxes
        const checkboxes = document.querySelectorAll("input[type='checkbox']");
        const checkData = {};
        checkboxes.forEach((box, index) => {
            checkData['check_' + index] = box.checked;
        });

        localStorage.setItem('WarRoom_Inputs', JSON.stringify(inputData));
        localStorage.setItem('WarRoom_Checks', JSON.stringify(checkData));
    }

    function loadData() {
        // Load Inputs
        const inputData = JSON.parse(localStorage.getItem('WarRoom_Inputs'));
        if (inputData) {
            const inputs = document.querySelectorAll("input[type='text'], textarea");
            inputs.forEach((input, index) => {
                if(inputData['input_' + index]) input.value = inputData['input_' + index];
            });
        }

        // Load Checkboxes
        const checkData = JSON.parse(localStorage.getItem('WarRoom_Checks'));
        if (checkData) {
            const checkboxes = document.querySelectorAll("input[type='checkbox']");
            checkboxes.forEach((box, index) => {
                if(checkData['check_' + index]) {
                    box.checked = true;
                    box.parentElement.classList.add('checked');
                }
            });
        }
    }

    // --- 4. COMMITMENT LOGIC ---
    function lockCommitment(btn) {
        const msg = document.getElementById('celebration-msg');
        const inputDiv = document.getElementById('ownership-display');
        const inputField = inputDiv.querySelector('input');
        
        if (inputDiv.style.display === 'none') {
            inputDiv.style.display = 'block';
            inputField.focus();
            btn.innerText = "SIGN & LOCK OWNERSHIP";
        } else {
            if(inputField.value.trim() === "") {
                alert("Please enter your name/deliverable first.");
                return;
            }
            btn.classList.add('locked');
            btn.innerHTML = "âœ“ OWNERSHIP LOCKED";
            btn.disabled = true;
            msg.style.opacity = 1;
            document.body.style.backgroundColor = "#e8f5e9";
            setTimeout(() => { document.body.style.backgroundColor = "var(--bg)"; }, 500);
            saveData();
        }
    }

    // --- 5. TIMER LOGIC ---
    let time = 15 * 60; 
    let timerInterval;
    const display = document.getElementById('time-display');

    function updateDisplay() {
        const minutes = Math.floor(time / 60);
        const seconds = time % 60;
        display.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
        if (timerInterval) return;
        timerInterval = setInterval(() => {
            if (time > 0) {
                time--;
                updateDisplay();
                if (time < 120) display.style.color = "var(--alert)";
            } else {
                clearInterval(timerInterval);
                display.innerText = "TIME UP";
                display.style.color = "var(--alert)";
                alert("Time is up!");
            }
        }, 1000);
    }

    function pauseTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    function resetTimer() {
        pauseTimer();
        time = 15 * 60;
        display.style.color = "#00A3E0";
        updateDisplay();
    }
</script>
